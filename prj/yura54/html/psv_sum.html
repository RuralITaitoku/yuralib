<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <title>PSV合計算出ツール</title>
        <style>
            body {
                font-family: sans-serif;
                line-height: 1.6;
                max-width: 800px;
                margin: 2em auto;
                padding: 0 1em;
            }
            textarea {
                width: 100%;
                height: 200px;
                margin-bottom: 10px;
            }
            button {
                padding: 10px 20px;
                cursor: pointer;
                background: #007bff;
                color: white;
                border: none;
                border-radius: 4px;
            }
            button:hover {
                background: #0056b3;
            }
            #result {
                margin-top: 20px;
                padding: 10px;
                background: #f8f9fa;
                border: 1px solid #ddd;
                word-break: break-all;
            }
            .success {
                color: #28a745;
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <h2>PSV数値列 合計算出ツール</h2>
        <p>PSVデータを貼り付けて「合計を計算してコピー」を押してください。</p>

        <textarea
            id="input"
            placeholder="例:&#10;項目A|100|200&#10;項目B|300|400"
        ></textarea>

        <button onclick="processPSV()">合計を計算してコピー</button>

        <div id="result"></div>

        <script>
            async function processPSV() {
                const input = document.getElementById("input").value.trim();
                const resultDiv = document.getElementById("result");

                if (!input) {
                    resultDiv.innerText = "データが入力されていません。";
                    return;
                }

                const lines = input.split("\n");
                let totals = [];

                lines.forEach((line) => {
                    const columns = line.split("|");
                    columns.forEach((val, index) => {
                        const num = parseFloat(val.trim());
                        if (!isNaN(num)) {
                            totals[index] = (totals[index] || 0) + num;
                        } else {
                            // 数値でない列は空文字または0として扱う（構造維持のため）
                            totals[index] = totals[index] || 0;
                        }
                    });
                });

                // PSV形式に結合
                const resultPSV = totals.join("|");

                try {
                    // クリップボードへコピー
                    await navigator.clipboard.writeText(resultPSV);
                    resultDiv.innerHTML = `<span class="success">コピー完了！</span><br>結果: <code>${resultPSV}</code>`;
                } catch (err) {
                    resultDiv.innerText = "コピーに失敗しました: " + resultPSV;
                }
            }
        </script>
    </body>
</html>
